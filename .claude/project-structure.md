# 项目结构和开发指南

## 多项目扩展

本平台设计用于托管多个具有多种客户端类型的项目：
- 每个项目应在其自己的目录中自包含
- 项目内的每个客户端应有自己的子目录
- 遵循一致的命名模式以便于导航
- 为每个新项目/客户端更新主服务器路由和主页
- 在所有客户端中保持高设计质量和代码标准
- 使用共享资源避免项目内代码重复

## 项目结构标准

项目应按业务领域组织，具有多种客户端类型：

```
/project-name/
├── user-app/               # 用户端/客户端
│   ├── index.html
│   └── assets/
│       ├── styles/
│       │   ├── main.css
│       │   ├── components.css
│       │   └── pages.css
│       ├── scripts/
│       │   ├── app.js
│       │   ├── router.js
│       │   ├── state.js
│       │   ├── api.js
│       │   └── utils.js
│       └── data/
│           ├── mock-data.js
│           └── config.js
├── admin-panel/            # 管理员后台
│   ├── index.html
│   └── assets/
│       ├── styles/
│       ├── scripts/
│       └── data/
├── merchant-dashboard/     # 商家后台 (if applicable)
│   ├── index.html
│   └── assets/
└── shared/                 # 共享资源
    ├── styles/
    │   └── common.css      # 共同样式
    ├── scripts/
    │   └── shared-utils.js # 共同工具函数
    └── data/
        └── shared-data.js  # 共同数据结构
```

## 按项目类别划分的常见客户端类型

- **电商项目**：user-app, merchant-dashboard, admin-panel
- **餐饮项目**：miniprogram, merchant-dashboard
- **社交项目**：user-app, admin-panel
- **教育项目**：student-app, teacher-panel, admin-panel
- **医疗项目**：patient-app, doctor-panel, admin-panel
- **金融项目**：user-app, advisor-panel, admin-panel

## 代码组织规则

- **index.html**：仅包含 HTML 结构，加载 CSS/JS 文件
- **单一职责**：每个文件处理一个特定关注点
- **文件大小限制**：保持每个文件在 300 行以下以确保可读性
- **模块化设计**：函数和组件应可复用
- **清晰命名**：文件和函数名称应自解释

## 平台概述

这是一个**可扩展的原型展示平台**，在统一的 Node.js 服务器下托管无限数量的项目。该平台为任何业务领域或用例提供静态前端原型服务。

### 当前项目：
- **点当餐厅 (Diandang Restaurant)**：完整的餐厅管理系统，包含客户小程序和商家仪表板
- **Mall商城 (Shopping Mall)**：电商系统，包含客户小程序和管理后台

### 未来项目能力：
- **任何业务领域**：医疗、教育、金融、社交、游戏等
- **多种客户端类型**：用户应用、管理面板、商家仪表板、员工工具
- **灵活架构**：单页应用、多页流程、混合方法
- **行业特定功能**：特定领域的 UI 模式和工作流程

## 开发命令

### 服务器管理
```bash
# 启动服务器（推荐 - 后台运行）
./start.sh

# 停止服务器
./stop.sh

# 检查服务器状态和日志
./status.sh

# 直接运行（前台，用于调试）
node serve.js

# 查看日志
tail -f server.log
```

### 开发工作流程
服务器默认在 **3000 端口** 运行，提供带有实时重载的静态文件服务。无需构建过程 - 文件直接提供服务。

## 项目架构

### 统一服务器 (serve.js)
- **文件**：`/serve.js` - 处理所有路由的主 HTTP 服务器
- **功能**： 
  - **可扩展的基于路径的路由**：目前支持 `/diandang/*`、`/mall/*`，可轻松扩展以支持任何新项目
  - **智能文件解析**：自动将项目路径映射到文件系统结构
  - **静态文件服务**：正确的 MIME 类型、缓存头、资源优化
  - **CORS 支持**：完全的开发友好的跨域支持
  - **错误处理**：带有项目感知消息的自定义 404/500 页面
  - **动态主页**：为所有可用项目自动生成展示页面
  - **热重载**：更改立即生效，无需重启服务器

### 前端应用
每个原型包含：
- **HTML**：单页应用入口点
- **CSS**：基于组件的样式（通常在 `assets/styles.css` 中）
- **JavaScript**：带有状态管理和路由的原生 JS（通常在 `assets/app.js` 中）

### 路由结构
```
/                                 -> 带有所有项目链接的动态主页

# 当前项目：
/diandang/miniprogram/            -> 客户点餐界面
/diandang/merchant/               -> 餐厅管理仪表板
/mall/miniprogram/                -> 购物小程序
/mall/admin/                      -> 电商管理面板

# 未来项目模式：
/{project-name}/{client-type}/    -> 任何新项目和客户端组合
# 示例：
/fitness/user-app/                -> 健身追踪用户应用
/fitness/trainer-panel/           -> 健身教练管理
/education/student-app/           -> 学生学习界面
/education/teacher-panel/         -> 教师管理仪表板
/healthcare/patient-app/          -> 患者门户
/healthcare/doctor-panel/         -> 医生工作流系统
```

## 核心技术模式

### 前端架构
- **单页应用**：每个原型使用基于哈希或基于状态的客户端路由
- **状态管理**：管理当前页面、用户数据、购物车内容等的全局状态对象
- **组件渲染**：使用模板字面量和 DOM 操作进行动态 HTML 生成
- **模拟数据**：广泛使用模拟数据对象进行原型开发（订单、产品、用户、分析）

### 服务器模式
- **路径解析**：将 URL 映射到文件系统路径的自定义路由逻辑
- **内容类型检测**：基于文件扩展名的自动 MIME 类型检测
- **开发功能**：无缓存头、CORS 支持、详细日志记录

## 开发说明

### 添加新项目

#### 新项目快速开始：
1. **创建项目结构**：
   ```bash
   mkdir /project-name
   mkdir /project-name/client-type
   mkdir /project-name/client-type/assets
   mkdir /project-name/client-type/assets/{styles,scripts,data}
   ```

2. **在 `serve.js` 中添加服务器路由**：
   - 在第 495 行附近添加新的 `else if (pathname.startsWith('/project-name/'))` 块
   - 遵循现有的路径解析和文件服务模式

3. **在 `generateIndexPage()` 函数中更新主页展示**：
   - 添加带有描述和客户端链接的新项目卡片
   - 遵循现有的 HTML 结构和样式模式

4. **遵循项目结构标准**：
   - 使用上述定义的标准化目录布局
   - 实现适当的文件分离和组织
   - 在存在多个客户端时包含共享资源

#### 高级配置：
- **自定义路由逻辑**：用于复杂 URL 模式或特殊处理
- **共享资源**：利用 `/shared/` 目录存放跨客户端资源
- **环境配置**：在 `/data/config.js` 中的项目特定设置
- **模拟 API**：用于真实原型开发的结构化虚假数据

### 文件组织最佳实践
- **项目隔离**：每个项目完全自包含
- **客户端分离**：每种客户端类型都有自己的子目录和资源
- **资源管理**：适当的缓存头、MIME 类型和路径解析
- **共享资源**：在项目内使用 `/shared/` 存放常用工具
- **相对导入**：所有资源使用相对路径以确保可移植性

### 平台管理

#### 服务器操作
- **服务器日志**：检查 `/server.log` 获取请求日志、错误和访问模式
- **进程管理**：PID 存储在 `/server.pid` 中用于安全的启动/停止操作
- **端口冲突**：自动检测和解决端口冲突
- **公共访问**：为 localhost 和公共 IP 访问配置
- **开发模式**：无缓存头确保开发过程中的即时更新

#### 主页管理
动态主页（`generateIndexPage()` 函数）自动：
- **发现项目**：扫描可用的项目目录
- **生成卡片**：创建带有描述和链接的样式化项目卡片
- **保持一致性**：在所有项目展示中遵循统一的 UI 模式
- **处理扩展**：响应式布局适应任意数量的项目

#### 维护任务
- **添加新项目**：遵循上述标准化工作流程
- **更新项目信息**：在主页生成器中修改描述和元数据
- **监控使用**：检查服务器日志以查看热门项目和错误模式
- **性能优化**：考虑对高流量项目进行静态资源优化