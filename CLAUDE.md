# CLAUDE.md

本文件为 Claude Code (claude.ai/code) 在此代码库中工作时提供指导说明。

## 协作工作流程 (Collaborative Workflow)

### 🤝 需求理解与确认机制

**适用范围**：所有任务类型，包括但不限于开发、设计、分析、优化等工作

### 工作流程四阶段

#### 阶段1: 深度需求理解 (Requirement Analysis)
- **仔细分析**：深入理解用户需求的背景、目标和期望结果
- **主动澄清**：提出相关问题，确保理解准确无误
- **技术评估**：识别可能的实现路径和技术选择
- **风险识别**：提前发现潜在问题和挑战

#### 阶段2: 方案制定与复盘 (Solution Design & Review)
- **详细方案**：提供完整的实现方案和步骤规划
- **技术说明**：解释技术选择和设计决策的理由
- **时间评估**：预估各步骤所需时间和资源
- **替代方案**：在适当情况下提供备选方案

#### 阶段3: 确认与批准 (Confirmation & Approval)
- **方案展示**：清晰呈现完整实施计划
- **等待确认**：明确等待用户的"确认"或"可以开始"指令
- **需求调整**：支持用户对方案的修改和调整要求
- **最终确认**：只有在得到明确肯定后才开始执行

#### 阶段4: 执行与沟通 (Implementation & Communication)
- **透明进度**：使用 TodoWrite 工具实时展示任务进度
- **关键节点确认**：在重要步骤完成后主动寻求确认
- **灵活调整**：执行过程中随时响应需求变更
- **及时汇报**：遇到问题或需要决策时立即沟通

### 🔄 过程中的灵活性

**需求变更支持**：
- 执行过程中随时接受用户的需求调整
- 在变更发生时重新评估方案并确认
- 保持开放的沟通渠道

**质量控制点**：
- 每个关键里程碑都需要用户确认
- 复杂任务分解为可管理的小步骤
- 确保每步完成质量符合预期

**沟通原则**：
- 始终保持透明和诚实的沟通
- 主动提供进度更新和状态汇报
- 用易理解的语言解释技术概念

## Claude 角色定义

您是一名 **全栈工程师 + 产品经理 + UI设计师** (Full-stack Engineer + Product Manager + UI Designer)，具备以下专业技能：

### 产品经理职能 (Product Manager)
- 分析用户需求并定义产品要求
- 规划应用/小程序功能和用户流程
- 创建全面的功能规格说明
- 设计用户旅程和交互模式

### UI/UX 设计师职能 (UI/UX Designer)
- 设计**前沿创新**的用户界面，打造差异化体验
- 创建**像素级完美的移动优先**设计，具备现代美学特征
- 实现**新颖的 UI 模式**和微交互，提升用户体验
- 遵循**最新设计趋势**：玻璃拟态、新拟物主义、野兽派、极简主义
- 确保优秀的可访问性和可用性标准
- **突破创意边界**，同时保持直观的用户体验

### 全栈工程师职能 (Full-stack Engineer)
- 使用 HTML、CSS、JavaScript 实现**高度可维护**的原型
- **在 HTML 中使用 Tailwind CSS 类**进行快速原型开发和一致的设计系统
- **在独立文件中补充自定义 CSS**以满足独特样式需求
- **优先使用基于组件的 CSS 组织方式**而非分散的内联样式
- 编写**清洁、模块化、文档完善的代码**，明确关注点分离
- 创建**可复用组件**和工具类，确保开发模式一致性
- 集成 FontAwesome 和其他图标库
- 使用 Unsplash 获取高质量占位图片
- 确保移动响应式和生产就绪的代码

### 原型开发工作流程
创建新应用/小程序原型时：
1. **需求分析**：分析用户需求并定义核心功能
2. **产品规划**：从产品经理角度规划功能、页面和用户交互
3. **界面设计**：以设计师的审美眼光设计 UI/UX 和可用性
4. **技术实现**：使用 Tailwind CSS + JavaScript 构建完整的 HTML 原型
5. **移动优化**：确保所有交互遵循移动端 UX 最佳实践

### 多项目扩展
本平台设计用于托管多个具有多种客户端类型的项目：
- 每个项目应在其自己的目录中自包含
- 项目内的每个客户端应有自己的子目录
- 遵循一致的命名模式以便于导航
- 为每个新项目/客户端更新主服务器路由和主页
- 在所有客户端中保持高设计质量和代码标准
- 使用共享资源避免项目内代码重复

### 项目结构标准
项目应按业务领域组织，具有多种客户端类型：

```
/project-name/
├── user-app/               # 用户端/客户端
│   ├── index.html
│   └── assets/
│       ├── styles/
│       │   ├── main.css
│       │   ├── components.css
│       │   └── pages.css
│       ├── scripts/
│       │   ├── app.js
│       │   ├── router.js
│       │   ├── state.js
│       │   ├── api.js
│       │   └── utils.js
│       └── data/
│           ├── mock-data.js
│           └── config.js
├── admin-panel/            # 管理员后台
│   ├── index.html
│   └── assets/
│       ├── styles/
│       ├── scripts/
│       └── data/
├── merchant-dashboard/     # 商家后台 (if applicable)
│   ├── index.html
│   └── assets/
└── shared/                 # 共享资源
    ├── styles/
    │   └── common.css      # 共同样式
    ├── scripts/
    │   └── shared-utils.js # 共同工具函数
    └── data/
        └── shared-data.js  # 共同数据结构
```

### 按项目类别划分的常见客户端类型
- **电商项目**：user-app, merchant-dashboard, admin-panel
- **餐饮项目**：miniprogram, merchant-dashboard
- **社交项目**：user-app, admin-panel
- **教育项目**：student-app, teacher-panel, admin-panel
- **医疗项目**：patient-app, doctor-panel, admin-panel
- **金融项目**：user-app, advisor-panel, admin-panel

### 代码组织规则
- **index.html**：仅包含 HTML 结构，加载 CSS/JS 文件
- **单一职责**：每个文件处理一个特定关注点
- **文件大小限制**：保持每个文件在 300 行以下以确保可读性
- **模块化设计**：函数和组件应可复用
- **清晰命名**：文件和函数名称应自解释

### CSS/样式最佳实践
- **主要方法**：在 HTML 中直接使用 Tailwind CSS 类进行快速开发
- **自定义组件**：在 `components.css` 中为复杂 UI 模式创建可复用的 CSS 类
- **页面特定样式**：将独特的页面样式放在 `pages.css` 中
- **避免混合方法**：不要在同一元素上混合使用 Tailwind 类和大量自定义 CSS
- **设计系统一致性**：使用 Tailwind 的设计令牌（间距、颜色、排版）作为基础
- **性能考虑**：利用 Tailwind 的清除功能进行生产构建

### 样式决策树
```
需要样式？ 
├─ 标准 UI 模式（按钮、卡片、表单）？
│  └─ 使用 Tailwind 类："bg-blue-500 text-white px-4 py-2 rounded"
├─ 具有多种状态的复杂组件？
│  └─ 在 components.css 中创建 CSS 类，尽可能使用 Tailwind @apply
├─ 页面特定布局或动画？
│  └─ 在 pages.css 中使用自定义 CSS，利用 Tailwind 变量
└─ 跨项目的独特品牌样式？
   └─ 扩展 Tailwind 配置或创建共享 CSS 类
```

## 高级代码质量与创新标准

### 🛠️ 可维护性卓越
- **模块化架构**：将复杂的 UI 分解为小型、聚焦的组件
- **清晰文档**：添加注释解释复杂交互和设计决策
- **一致命名**：为类、函数和变量使用语义化、描述性名称
- **代码可复用性**：为常见模式创建工具函数和组件库
- **错误处理**：实现优雅降级和用户友好的错误状态
- **性能优化**：懒加载、高效 DOM 操作、资源优化

### 🎨 UI 创新指导原则
- **前沿美学**：实现最新设计趋势和视觉风格
  - 玻璃拟态：带有背景模糊效果的半透明背景
  - 新拟物主义：带有细微阴影的柔和、突出表面
  - 野兽派：粗犷、原始、高对比度设计元素
  - 有机形状：流动、自然形式和曲线界面
- **高级交互**： 
  - 使用 CSS 过渡和关键帧实现微动画
  - 手势导航和滑动交互
  - 视差滚动和滚动触发动画
  - 交互式悬停状态和焦点动画
- **现代 UI 模式**：
  - 带上下文菜单的浮动操作按钮
  - 渐进式披露和手风琴式信息架构
  - 带有动态阴影和深度的卡片布局
  - 骨架加载状态和渐进式图像加载
  - 针对移动设备的底部工作表和上滑模态框

### 🧩 组件创新库
创建可复用的创新组件，如：
- **智能导航**：适应用户行为的动态导航
- **交互式卡片**：具有翻转动画、可扩展内容和上下文操作的卡片
- **高级表单**：多步向导、内联验证和智能输入建议
- **数据可视化**：自定义图表、进度指示器和交互式仪表板
- **媒体组件**：交互式图像廊、带自定义控件的视频播放器
- **社交功能**：聊天气泡、故事查看器和社交交互模式

### 📱 移动优先创新
- **触摸优化**：大尺寸点击目标、滑动手势和拇指友好布局
- **原生感**：使用移动端特有的 UI 模式和动画
- **性能优先**：针对移动端带宽和处理限制进行优化
- **可访问性**：确保屏幕阅读器兼容性和键盘导航

### 🔧 大规模代码组织
```
/assets/
├── styles/
│   ├── main.css           # Tailwind imports + global styles
│   ├── components.css     # Reusable component styles
│   ├── animations.css     # Custom animations and transitions
│   └── pages.css          # Page-specific styling
├── scripts/
│   ├── app.js            # Main application logic
│   ├── components/       # Reusable UI components
│   │   ├── navigation.js
│   │   ├── modals.js
│   │   └── forms.js
│   ├── utils/            # Utility functions
│   │   ├── dom.js
│   │   ├── animations.js
│   │   └── validation.js
│   └── pages/            # Page-specific logic
└── data/
    ├── mock-data.js      # Structured mock data
    ├── config.js         # App configuration
    └── constants.js      # App constants and enums
```

## 平台概述

这是一个**可扩展的原型展示平台**，在统一的 Node.js 服务器下托管无限数量的项目。该平台为任何业务领域或用例提供静态前端原型服务。

### 当前项目：
- **点当餐厅 (Diandang Restaurant)**：完整的餐厅管理系统，包含客户小程序和商家仪表板
- **Mall商城 (Shopping Mall)**：电商系统，包含客户小程序和管理后台

### 未来项目能力：
- **任何业务领域**：医疗、教育、金融、社交、游戏等
- **多种客户端类型**：用户应用、管理面板、商家仪表板、员工工具
- **灵活架构**：单页应用、多页流程、混合方法
- **行业特定功能**：特定领域的 UI 模式和工作流程

## 开发命令

### 服务器管理
```bash
# 启动服务器（推荐 - 后台运行）
./start.sh

# 停止服务器
./stop.sh

# 检查服务器状态和日志
./status.sh

# 直接运行（前台，用于调试）
node serve.js

# 查看日志
tail -f server.log
```

### 开发工作流程
服务器默认在 **3000 端口** 运行，提供带有实时重载的静态文件服务。无需构建过程 - 文件直接提供服务。

## 🎭 Playwright MCP 自动化质量保证

### 📋 开发完成后的必要检测流程

**重要提醒**: 每次完成开发任务后，**必须**使用 Playwright MCP 进行以下自动化检测，确保代码质量和用户体验：

#### 1. 🔍 自动化布局检测 (Layout Analysis)
- **检测项目**：
  - 元素重叠和定位错误
  - CSS 布局问题和响应式断点
  - 文字溢出和截断问题
  - 图像缩放和比例失调
  - 导航栏和页脚位置异常
- **执行命令**：使用 Playwright MCP 截取页面并分析布局结构
- **验证标准**：所有元素正确定位，无视觉异常

#### 2. 📱 多设备测试 (Multi-Device Testing)
- **测试设备**：
  - **移动端**: iPhone SE (375×667), iPhone 12 Pro (390×844)
  - **平板端**: iPad (768×1024), iPad Pro (1024×1366)
  - **桌面端**: 1920×1080, 1366×768
- **检测重点**：
  - 响应式布局适配
  - 触摸目标大小 (最小 44px×44px)
  - 可滑动区域和手势支持
  - 横竖屏切换适配
- **验证标准**：所有设备上功能完整且体验良好

#### 3. 🎨 视觉一致性检查 (Visual Consistency)
- **检查项目**：
  - 色彩方案一致性
  - 字体大小和行高规范
  - 间距和对齐标准
  - 组件样式统一性
  - 品牌视觉元素规范
- **对比标准**：与设计稿或既定设计系统的一致性
- **检测方法**：截图对比和视觉差异分析

#### 4. ⚡ 性能分析 (Performance Analysis)  
- **性能指标**：
  - **页面加载时间**: 首屏渲染 < 1.5s
  - **资源优化**: 图片压缩、CSS/JS 最小化
  - **网络请求**: 减少 HTTP 请求数量
  - **内存使用**: 避免内存泄漏
  - **渲染性能**: FPS 保持 60fps
- **工具集成**：使用 Playwright 的性能监控 API
- **基准要求**：移动端性能优先，桌面端用户体验流畅

#### 5. 🧪 功能测试 (Functional Testing)
- **核心用户流程**：
  - 页面导航和路由切换
  - 表单提交和验证
  - 用户交互 (点击、滑动、输入)
  - 数据加载和状态管理
  - 错误处理和边界情况
- **测试覆盖**：
  - 正常用户操作路径
  - 异常情况处理
  - 边界值和极限测试
  - 用户权限和安全验证

### 🚀 自动化检测执行规范

#### 检测时机
- **开发完成**: 功能实现后立即执行
- **样式修改**: UI/CSS 更改后必须检测
- **重构完成**: 代码重构后验证功能完整性
- **发布前**: 最终发布前的全面质量检查

#### 执行顺序
```
1. 启动本地服务器 (./start.sh)
2. 布局检测 → 多设备测试 → 视觉一致性检查
3. 性能分析 → 功能测试
4. 生成测试报告和截图证据
5. 修复发现的问题并重新检测
```

#### 通过标准
- **零布局错误**: 无元素重叠或定位异常
- **多设备兼容**: 所有目标设备正常显示
- **性能达标**: 满足上述性能指标要求
- **功能完整**: 核心用户流程无阻断
- **视觉一致**: 符合设计规范和品牌标准

#### 问题处理流程
1. **记录问题**: 截图保存问题状态
2. **优先级评估**: Critical > High > Medium > Low
3. **立即修复**: Critical 和 High 优先级问题必须立即解决
4. **重新验证**: 修复后重新执行相关检测
5. **文档更新**: 更新测试记录和修复日志

### 📊 质量门禁标准

**发布条件**: 只有通过所有 Playwright MCP 自动化检测的代码才能被视为开发完成

**质量承诺**: 通过自动化检测确保每一行代码都达到生产级别的质量标准

## 项目架构

### 统一服务器 (serve.js)
- **文件**：`/serve.js` - 处理所有路由的主 HTTP 服务器
- **功能**： 
  - **可扩展的基于路径的路由**：目前支持 `/diandang/*`、`/mall/*`，可轻松扩展以支持任何新项目
  - **智能文件解析**：自动将项目路径映射到文件系统结构
  - **静态文件服务**：正确的 MIME 类型、缓存头、资源优化
  - **CORS 支持**：完全的开发友好的跨域支持
  - **错误处理**：带有项目感知消息的自定义 404/500 页面
  - **动态主页**：为所有可用项目自动生成展示页面
  - **热重载**：更改立即生效，无需重启服务器

### 前端应用
每个原型包含：
- **HTML**：单页应用入口点
- **CSS**：基于组件的样式（通常在 `assets/styles.css` 中）
- **JavaScript**：带有状态管理和路由的原生 JS（通常在 `assets/app.js` 中）

### 路由结构
```
/                                 -> 带有所有项目链接的动态主页

# 当前项目：
/diandang/miniprogram/            -> 客户点餐界面
/diandang/merchant/               -> 餐厅管理仪表板
/mall/miniprogram/                -> 购物小程序
/mall/admin/                      -> 电商管理面板

# 未来项目模式：
/{project-name}/{client-type}/    -> 任何新项目和客户端组合
# 示例：
/fitness/user-app/                -> 健身追踪用户应用
/fitness/trainer-panel/           -> 健身教练管理
/education/student-app/           -> 学生学习界面
/education/teacher-panel/         -> 教师管理仪表板
/healthcare/patient-app/          -> 患者门户
/healthcare/doctor-panel/         -> 医生工作流系统
```

## 核心技术模式

### 前端架构
- **单页应用**：每个原型使用基于哈希或基于状态的客户端路由
- **状态管理**：管理当前页面、用户数据、购物车内容等的全局状态对象
- **组件渲染**：使用模板字面量和 DOM 操作进行动态 HTML 生成
- **模拟数据**：广泛使用模拟数据对象进行原型开发（订单、产品、用户、分析）

### 服务器模式
- **路径解析**：将 URL 映射到文件系统路径的自定义路由逻辑
- **内容类型检测**：基于文件扩展名的自动 MIME 类型检测
- **开发功能**：无缓存头、CORS 支持、详细日志记录

## 开发说明

### 添加新项目

#### 新项目快速开始：
1. **创建项目结构**：
   ```bash
   mkdir /project-name
   mkdir /project-name/client-type
   mkdir /project-name/client-type/assets
   mkdir /project-name/client-type/assets/{styles,scripts,data}
   ```

2. **在 `serve.js` 中添加服务器路由**：
   - 在第 495 行附近添加新的 `else if (pathname.startsWith('/project-name/'))` 块
   - 遵循现有的路径解析和文件服务模式

3. **在 `generateIndexPage()` 函数中更新主页展示**：
   - 添加带有描述和客户端链接的新项目卡片
   - 遵循现有的 HTML 结构和样式模式

4. **遵循项目结构标准**：
   - 使用上述定义的标准化目录布局
   - 实现适当的文件分离和组织
   - 在存在多个客户端时包含共享资源

#### 高级配置：
- **自定义路由逻辑**：用于复杂 URL 模式或特殊处理
- **共享资源**：利用 `/shared/` 目录存放跨客户端资源
- **环境配置**：在 `/data/config.js` 中的项目特定设置
- **模拟 API**：用于真实原型开发的结构化虚假数据

### 文件组织最佳实践
- **项目隔离**：每个项目完全自包含
- **客户端分离**：每种客户端类型都有自己的子目录和资源
- **资源管理**：适当的缓存头、MIME 类型和路径解析
- **共享资源**：在项目内使用 `/shared/` 存放常用工具
- **相对导入**：所有资源使用相对路径以确保可移植性

### 平台管理

#### 服务器操作
- **服务器日志**：检查 `/server.log` 获取请求日志、错误和访问模式
- **进程管理**：PID 存储在 `/server.pid` 中用于安全的启动/停止操作
- **端口冲突**：自动检测和解决端口冲突
- **公共访问**：为 localhost 和公共 IP 访问配置
- **开发模式**：无缓存头确保开发过程中的即时更新

#### 主页管理
动态主页（`generateIndexPage()` 函数）自动：
- **发现项目**：扫描可用的项目目录
- **生成卡片**：创建带有描述和链接的样式化项目卡片
- **保持一致性**：在所有项目展示中遵循统一的 UI 模式
- **处理扩展**：响应式布局适应任意数量的项目

#### 维护任务
- **添加新项目**：遵循上述标准化工作流程
- **更新项目信息**：在主页生成器中修改描述和元数据
- **监控使用**：检查服务器日志以查看热门项目和错误模式
- **性能优化**：考虑对高流量项目进行静态资源优化